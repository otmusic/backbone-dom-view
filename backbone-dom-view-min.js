(function(e){if(typeof define==="function"&&define.amd){define(["backbone","underscore"],e)}else{BackboneDomView=e(Backbone,_)}})(function(e,t){"use strict";var n=true;o.v="1.61.5";var i=e.View,r=e.$;function o(e){e=e||{};if(M(e,"parent")){this.parent=e.parent}this.attributes={};this.callbacks={};for(var t in e){if(!M(e,t))continue;if(typeof e[t]==="function"){this.callbacks[t]=e[t]}}if(this.defaults){this.set(B(this,"defaults"))}i.apply(this,arguments);a.template.call(this,"",this.template);this.trigger(o.readyEvent)}e.BackboneDomView=i.extend({constructor:o,ui:{root:""},selectorsSorter:t.keys,setElement:function(){i.prototype.setElement.apply(this,arguments);var e=this.ui=B(this,"ui");for(var t in e){if(!M(e,t)||typeof e[t]!=="string")continue;s(this,t)}this.template=B(this,"template",true);this.trigger(o.elementEvent);return this},find:function(e){if(!e)return this.$el;if(this.ui[e]){return s(this,e)}if(e.indexOf("{")>-1){var t=this,n=this.$el.selector&&this.$el.selector.length;e=e.replace(l,function(e,i){var r=s(t,i).selector||"";return n?r.slice(n):r})}var i=this.$el.find(e);if(!i.selector){i.selector=e}return i},bind:function(e,t){var n=this,i=n.model;if(arguments.length===1&&typeof e==="object"){var r=e;e=r.events;t=r.callback;if(M(r,"model")){i=r.model}}e=e.trim().split(/\s+/);for(var o=0,s=e.length;o<s;o++){f(e[o])}function f(e){var r=i,o=null,s=e.charAt(0)==="!";if(s){e=e.slice(1)}if(e.charAt(0)==="="){e=e.slice(1);r=M(n.attributes,e)?n:i;f(r.get(e));return}if(e.charAt(0)==="@"){e=e.slice(1);r=M(n.attributes,e)?n:i;o=1;f(r,r.get(e));e="change:"+e}if(e.charAt(0)==="#"){e=e.slice(1);r=n}if(!e){console.warn("Empty event name")}if(r===i){n.listenTo(i,e,f)}else{n.on(e,f)}function f(){var e=o===null?arguments:[arguments[o]];if(s){e[0]=!e[0]}return t.apply(n,e)}}return this},bindTo:function(e,t,n){return this.bind({model:e,events:t,callback:n})},matches:function(e){for(var t in e){if(!M(e,t))continue;if(e[t]===this.get(t))continue;if(e[t]instanceof RegExp){if(!e[t].test(this.get(t)))return false}else{return false}}return true},get:e.Model.prototype.get,set:e.Model.prototype.set,has:e.Model.prototype.has,_validate:e.Model.prototype._validate,getViewList:function(e){return this.template[e].each.viewList},listenElement:f("on"),listenElementOnce:f("one"),stopListeningElement:function(e,n){if(!this._listenElement)return this;var i=".listenBy"+this.cid;if(e){e=e instanceof r?e:r(e)}if(n){n=n.split(/\s+/).map(function(e){return e+i}).join(" ")}var o,s;switch(arguments.length){case 0:for(o=0,s=this._listenElement.length;o<s;o++){r(this._listenElement[o]).off(i)}this._listenElement=null;break;case 1:e.off(i);break;case 2:e.off(n);break;default:var f=this;var a=t.rest(arguments).map(function(e){if(typeof e==="function"&&e["_bindWith"+f.cid]){return e["_bindWith"+f.cid]}else{return e}});a[0]=n;e.off.apply(e,a);break}return this}});function s(e,t){var n=e.ui[t];if(typeof n==="string"){e.ui[t]=e.find(n)}return e.ui[t]}function f(e){return function(i,o){if(n){if(i instanceof r===false&&i instanceof window.HTMLElement===false){throw new Error("node should be instance of jQuery or HTMLElement")}}if(!this._listenElement)this._listenElement=[];var s=".listenBy"+this.cid;if(this._listenElement.indexOf(i)===-1){this._listenElement.push(i)}i=i instanceof r?i:r(i);if(o){o=o.split(/\s+/).map(function(e){return e+s}).join(" ")}var f=this;var a=t.rest(arguments).map(function(e){if(typeof e==="function"){var n="_bindWith"+f.cid;if(!e[n]){e[n]=t.bind(e,f)}return e[n]}else{return e}});a[0]=o;i[e].apply(i,a);return this}}o.readyEvent="template-ready";o.elementEvent="element-ready";var a=o.helpers={template:c,class:u,toggleClass:u,attr:d,prop:h,style:p,html:v,safeHtml:m,text:w,on:y("listenElement"),once:y("listenElementOnce"),click:g,connect:E,visible:b,hidden:k,each:x};var l=/\{([^}]+)}/g;function c(e,t){var i=this.selectorsSorter(t),r;if(e&&M(this.ui,e)){e="{"+e+"}"}for(var o=0,s=i.length;o<s;o++){r=i[o];var f=t[r];if(e){if(r.charAt(0)==="&"){r=r.slice(1)}else{r=" "+r}}for(var l in f){if(!M(f,l))continue;if(l.charAt(0)==="&"){var u={};u[l]=f[l];c.call(this,e+r,u);continue}if(n){if(!M(a,l)){throw new Error('Unknown helper "'+l+'" in template of '+this.constructor.name)}}a[l].call(this,e+r,f[l])}}}function u(e,n){A({view:this,node:this.find(e),method:"toggleClass",options:n,wrapper:function(e){if(t.isFunction(e)){return function(){return!!e.apply(this,arguments)}}return!!e}})}function d(e,t){A({view:this,node:this.find(e),method:"attr",options:t})}function h(e,t){A({view:this,node:this.find(e),method:"prop",options:t})}function p(e,t){A({view:this,node:this.find(e),method:"css",options:t})}function v(e,t){_({view:this,node:this.find(e),method:"html",options:t})}function m(e,t){var n=/<(?:script|style|link|meta|iframe|frame)\b/gi,i=/<\/(?:script|style|link|meta|iframe|frame)\b/gi,r=/\w/;_({view:this,node:this.find(e),method:"html",options:t,wrapper:function(e){e=e.replace(n,'<div style="display: none;"').replace(i,"</div");var t=0;var o;var s;for(var f=0,a=e.length;f<a;f++){s=e[f];if(t===0&&s==="<"&&r.test(e[f+1])){t=1}else if(s===">"&&(t!==5||o===" ")){t=0}else if(s===" "&&t===1){t=2}else if(s!==" "&&t===2){t=3;if(s==="o"&&e[f+1]==="n"){e=e.slice(0,f)+"x-"+e.slice(f+2)}}else if(s==="="&&t===3){t=4}else if((s==='"'||s==="'")&&t===4){o=s;t=5}else if(s!==" "&&t===4){o=" ";t=5}else if(s===o&&t===5){o=false;t=2}}return e}})}function w(e,n){_({view:this,node:this.find(e),method:"text",options:n,wrapper:function(e){return t.isNull(e)||t.isUndefined(e)?"":e}})}function y(e){return function(t,i){var r=this,o=this.find(t),s;for(var f in i){if(!M(i,f))continue;s=i[f];switch(typeof s){case"function":this[e](o,f,s);break;case"object":for(var a in s){if(!M(s,a))continue;this[e](o,f,a,s[a])}break;case"string":(function(t){var i=t.charAt(0)==="!";if(i){t=t.slice(1)}if(n){if(t&&typeof r[t]!=="function"){console.warn('View "%s" do not have method "%s"',r.constructor.name,t)}}r[e](o,f,function(e){if(i){e.preventDefault()}if(t){this[t]()}})})(s);break}}}}function g(e,t){a["on"].call(this,e,{click:t})}function E(e,t){var n=this,i=n.find(e);for(var r in t){if(!M(t,r))continue;o(r,t[r])}function o(e,t){var r="change",o=e.split("|");if(o.length===2){e=o[0];r=o[1]}var s=n.has(t)?n:n.model;n.listenElement(i,r,function(n){s.set(t,n.currentTarget[e])});n.listenTo(s,"change:"+t,function(t,n){i.prop(e,n)});i.prop(e,s.get(t))}}function b(e,t){A({view:this,node:this.find(e),method:"css",options:{display:t},wrapper:function(e){return e?"":"none"}})}function k(e,t){A({view:this,node:this.find(e),method:"css",options:{display:t},wrapper:function(e){return e?"none":""}})}function _(e){var n=e.view,i=n.model,r=e.options;e=t.extend({model:i},e);switch(typeof r){case"string":s(r);break;case"object":if(r===null)break;for(var o in r){if(!M(r,o)||r[o]===null)continue;s(o,r[o])}break;case"function":e.value=r.apply(n,arguments);$(e);break;default:throw new Error("Unknown options type")}function s(t,i){n.bind(t,function(){e.value=i?i.apply(n,arguments):arguments[0];$(e)})}}function $(e){var i=e.view,o=e.node,s=e.method,f=e.fieldName,a=e.value,l=e.wrapper;if(n){if(o.length===0){console.warn("Empty node. Be sure that you set correct selector to template of "+e.view.constructor.name)}}if(t.isFunction(a)){o.each(function(e,t){var n=a.call(i,e,t);if(l){n=l(n)}if(f){r(t)[s](f,n)}else{r(t)[s](n)}})}else{if(l){a=l(a)}if(f){o[s](f,a)}else{o[s](a)}}}function A(e){var t=e.options;for(var n in t){if(!M(t,n))continue;e.fieldName=n;e.options=t[n];_(e)}}function x(i,o){t.defaults(o,{addHandler:"append",delHandler:"remove",addEvent:"add",resetEvent:"reset",removeEvent:"remove",addedEvent:"added",sort:false,sortByViews:false,offOnRemove:true});o.eachAddListener=E;o.eachResetListener=b;o.eachRemoveListener=k;var s=this,f=s.find(i),a=s.model,l,c,u,d;if(typeof o.el==="function"){o.el=o.el.call(s)}switch(typeof o.el){case"string":l=f.find(o.el).detach();break;case"object":if(o.el instanceof r){l=o.el.detach()}else{c=t.map(o.el,function(e,t){var n={};f.find("> ["+t+"]").detach().each(function(e,i){n[i.getAttribute(t)]=r(i)});return{field:e,nodes:n}})}break}if(o.field){var h=o.field;u=h;if(typeof h==="object"){u=h.name;d=h.wrapper}a=s.get(u)||s.model.get(u)}var p=o.viewList=new T;var v=o.addHandler;var m=o.delHandler;if(typeof v==="string"){v=x.addHandlers[v]}if(typeof m==="string"){m=x.delHandlers[m]}var w=o.sort;if(w){s.listenTo(a,w.event||"sort",$)}var y=o.sortByViews;if(y){var g=typeof y==="string"?y:y.event;s.on(g,B)}if(!d){if(n){if(!a){throw new Error("Collection is not specified")}if(a instanceof e.Collection===false){throw new Error("Object is not instance of Backbone Collection")}}s.listenTo(a,o.addEvent,E).listenTo(a,o.resetEvent,b).listenTo(a,o.removeEvent,k);if(o.field){s.listenTo(a,[o.addEvent,o.removeEvent,o.resetEvent].join(" "),_)}a.each(E)}else{if(L(d)){a=new d;s.bind("@"+u,function(e){a.each(k);a.reset(e);a.each(E)})}else{a=null;s.bind("@"+u,function(e){if(a){a.each(k);a.reset([])}a=d.call(s,e);a.each(E)})}}if(o.viewProp){if(n){if(this[o.viewProp]){console.warn('view already has property "'+o.viewProp+'"')}}this[o.viewProp]=p}function E(e,n,i){var r=L(o.view)?o.view:o.view.call(s,e),a=r;if(L(r)){var u={model:e,parent:s};var d;if(c){t.find(c,function(n){var i=t.isFunction(n.field)?n.field(e):e.get(n.field);d=n.nodes[i];return!!d})}if(!d){d=l}if(d){u.el=d.clone()}a=new r(u)}a.parent=a.parent||s;p[e.cid]=a;v.call(s,f,a,i);a.trigger(o.addedEvent)}function b(e,t){t.previousModels.forEach(k);a.each(E)}function k(e){var t=p[e.cid];m.call(s,f,t);t.trigger(o.removeEvent,s);if(t.parent===s){t.parent=null}if(o.offOnRemove){t.off().stopListening().stopListeningElement()}delete p[e.cid]}function _(){s.trigger("change:"+o.field,s,a)}function $(){if(w.field){a.toArray().sort(j).reduce(A)}else{a.reduce(A)}}function A(e,t,n){if(n===1){var i=p[e.cid].$el;f.prepend(i);e=i}return p[t.cid].$el.insertAfter(e)}function j(e,t){e=e.get(w.field);t=t.get(w.field);return e<t?-1:e===t?0:1}function B(){if(y.field){a.forEach(function(e){e.set(y.field,H(e))})}else{a.models=a.sortBy(H)}}function H(e){return p[e.cid].$el.index()}}x.addHandlers={append:function(e,t){e.append(t.$el)},appendAt:function(e,t,n){if(M(n,"at")){if(n.at===0){e.prepend(t.$el)}else{t.$el.insertAfter(e.children().get(n.at-1))}}else{e.append(t.$el)}},prepend:function(e,t){e.prepend(t.$el)},fadeIn:function(e,t){t.$el.hide().appendTo(e).fadeIn()},slideDown:function(e,t){t.$el.hide().appendTo(e).slideDown()}};x.delHandlers={remove:function(e,t){t.$el.remove()},fadeOut:function(e,t){t.$el.fadeOut(function(){return t.$el.remove()})},slideUp:function(e,t){t.$el.slideUp(function(){return t.$el.remove()})}};x.EachViewList=T;function T(){}t.extend(T.prototype,{where:function(e,t){return this[t?"find":"filter"](function(t){return t.matches(e)})},findWhere:function(e){return this.where(e,true)},count:function(e){var t=0;this.forEach(function(n){if(n.matches(e)){t++}});return t},getModels:function(){return this.map(function(e){return e.model})},getByEl:function(e){if(e instanceof r){e=e.get(0)}return this.find(function(t){return t.el===e})},get:function(e){return this[e]||this[e.cid]||this.find(function(t){return t.cid===e||t.model===e||t.model.id===e||t.model.id===e.id})}});t.forEach(["forEach","map","reduce","reduceRight","find","filter","reject","every","some","max","min"],function(e){T.prototype[e]=function(n){return t[e](this,n,this)}});t.forEach(["contains","invoke","toArray","size","without","difference","isEmpty","chain"],function(e){T.prototype[e]=function(){var n=t.toArray(arguments);n.unshift(this);return t[e].apply(t,n)}});function L(e){return M(e,"prototype")&&t.isFunction(e.prototype.initialize)}function j(e,n,i){var r=e.prototype[n]||{};if(t.isFunction(r)){r=r.call(i,O)}var o=[r];return e.__super__?o.concat(j(e.__super__.constructor,n,i)):o}function B(e,t,n){var i=e.constructor;return(n?O:H).apply(null,j(i,t,e).reverse())}function H(){var e={};for(var t=0,n=arguments.length;t<n;t++){r.extend(e,arguments[t])}return e}function O(){var e={};for(var t=0,n=arguments.length;t<n;t++){r.extend(true,e,arguments[t])}return e}var M=t.has;return o});
//# sourceMappingURL=backbone-dom-view-min.map