// Generated by LiveScript 1.2.0
(function(){
  var slice$ = [].slice;
  function def(modules, module){
    if (typeof define === 'function' && define.amd) {
      return define(modules, module);
    } else {
      return module(Backbone);
    }
  }
  def(['backbone'], function(Backbone){
    var DOMView, helpers, dividedField, fieldEvent, viewEvent, argSelector;
    DOMView = Backbone.DOMView = Backbone.View.extend({
      constructor: function(ops){
        var rest, selector, ref$, helps, helper, options, own$ = {}.hasOwnProperty;
        rest = slice$.call(arguments, 1);
        if (ops instanceof Backbone.Model || ops instanceof Backbone.Collection) {
          Backbone.View.apply(this, [{
            model: ops
          }].concat(rest));
        } else {
          Backbone.View.apply(this, arguments);
        }
        if (typeof this.template === 'object') {
          this.template = Backbone.$.extend(true, {}, this.template);
          for (selector in ref$ = this.template) if (own$.call(ref$, selector)) {
            helps = ref$[selector];
            for (helper in helps) if (own$.call(helps, helper)) {
              options = helps[helper];
              helpers[helper].call(this, selector, options);
            }
          }
          this.trigger('template-ready');
        }
      },
      find: function(selector){
        if (selector) {
          return this.$el.find(selector);
        } else {
          return this.$el;
        }
      }
    });
    helpers = DOMView.helpers = {
      'class': classHelper,
      attr: attrHelper,
      prop: propHelper,
      style: styleHelper,
      html: htmlHelper,
      on: onHelper,
      connect: connectHelper,
      each: eachHelper
    };
    function classHelper(selector, options){
      callJquerySetterMethod.call(this, {
        node: this.find(selector),
        method: 'toggleClass',
        options: options,
        wrapper: function(v){
          return !!v;
        }
      });
    }
    function attrHelper(selector, options){
      callJquerySetterMethod.call(this, {
        node: this.find(selector),
        method: 'attr',
        options: options
      });
    }
    function propHelper(selector, options){
      callJquerySetterMethod.call(this, {
        node: this.find(selector),
        method: 'prop',
        options: options
      });
    }
    function styleHelper(selector, options){
      callJquerySetterMethod.call(this, {
        node: this.find(selector),
        method: 'css',
        options: options
      });
    }
    function htmlHelper(selector, options){
      callJqueryMethod.call(this, {
        node: this.find(selector),
        method: 'html',
        options: options
      });
    }
    function onHelper(selector, options){
      var node, i$, own$ = {}.hasOwnProperty;
      node = this.find(selector);
      for (i$ in options) if (own$.call(options, i$)) {
        (fn$.call(this, i$, options[i$]));
      }
      function fn$(event, func){
        var this$ = this;
        node.on(event, function(){
          return func.apply(this$, arguments);
        });
      }
    }
    function connectHelper(selector, options){
      var node, i$, own$ = {}.hasOwnProperty;
      node = this.find(selector);
      for (i$ in options) if (own$.call(options, i$)) {
        (fn$.call(this, i$, options[i$]));
      }
      function fn$(prop, field){
        var event, propEvent, x, this$ = this;
        event = 'change';
        if (propEvent = prop.match(dividedField)) {
          x = propEvent[0], prop = propEvent[1], event = propEvent[2];
        }
        node.on(event, function(){
          return this$.model.set(field, node.prop(prop));
        });
        this.model.on('change:' + field, function(model, value){
          if (value !== node.prop(prop)) {
            return node.prop(prop, value);
          }
        });
        node.prop(prop, this.model.get(field));
      }
    }
    dividedField = /^(.+)\|(.+)/;
    fieldEvent = /@([\w-]+)/;
    viewEvent = /#([\w-:\.]+)/;
    argSelector = /\|arg\((\d+)\)/;
    function callJqueryMethod(arg$){
      var node, method, options, wrapper, fieldName, model, view, events, i$, len$, value, own$ = {}.hasOwnProperty;
      node = arg$.node, method = arg$.method, options = arg$.options, wrapper = arg$.wrapper, fieldName = arg$.fieldName;
      model = this.model;
      view = this;
      switch (typeof options) {
      case 'string':
        events = options.split(/\s+/);
        for (i$ = 0, len$ = events.length; i$ < len$; ++i$) {
          (fn$.call(this, events[i$]));
        }
        break;
      case 'object':
        for (i$ in options) if (own$.call(options, i$)) {
          (fn1$.call(this, i$, options[i$]));
        }
        break;
      case 'function':
        value = options.apply(view, arguments);
        if (wrapper) {
          value = wrapper(value);
        }
        if (fieldName) {
          node[method](fieldName, value);
        } else {
          node[method](value);
        }
      }
      function fn$(event){
        var target, argNum;
        target = model;
        argNum = 0;
        event = event.replace(argSelector, function(x, num){
          argNum = num;
          return '';
        });
        event = event.replace(fieldEvent, function(x, field){
          target = model;
          argNum = 1;
          helperHandler(target, model.get(field));
          return 'change:' + field;
        });
        event = event.replace(viewEvent, function(x, event){
          target = view;
          helperHandler();
          return event;
        });
        target.on(event, helperHandler);
        function helperHandler(){
          var value;
          value = arguments[argNum];
          if (wrapper) {
            value = wrapper(value);
          }
          if (fieldName) {
            node[method](fieldName, value);
          } else {
            node[method](value);
          }
        }
      }
      function fn1$(events, func){
        var i$, len$, event, target;
        events = events.split(/\s+/);
        for (i$ = 0, len$ = events.length; i$ < len$; ++i$) {
          event = events[i$];
          if (viewEvent.test(event)) {
            event = event.replace('#', '');
            target = view;
          } else {
            target = model;
          }
          target.on(event, helperHandler);
        }
        function helperHandler(){
          var value;
          value = func.apply(view, arguments);
          if (wrapper) {
            value = wrapper(value);
          }
          if (fieldName) {
            node[method](fieldName, value);
          } else {
            node[method](value);
          }
        }
      }
    }
    function callJquerySetterMethod(ops){
      var options, name, value, own$ = {}.hasOwnProperty;
      options = ops.options;
      for (name in options) if (own$.call(options, name)) {
        value = options[name];
        ops.fieldName = name;
        ops.options = value;
        callJqueryMethod.call(this, ops);
      }
    }
    function eachHelper(selector, options){
      var view, holder, list, field;
      view = this;
      holder = this.find(selector);
      list = (field = options.field)
        ? this.model.get(field)
        : this.model;
      options.viewList = {};
      options.addHandler == null && (options.addHandler = 'append');
      options.delHandler == null && (options.delHandler = 'remove');
      if (typeof options.addHandler === 'string') {
        options.addHandler = eachHelper.addHandlers[options.addHandler];
      }
      if (typeof options.delHandler === 'string') {
        options.delHandler = eachHelper.delHandlers[options.delHandler];
      }
      view.listenTo(list, 'add', eachAddListener);
      view.listenTo(list, 'remove', eachRemoveListener);
      list.each(eachAddListener);
      function eachAddListener(model){
        var View, subView;
        View = isClass(options.view)
          ? options.view
          : options.view.call(view, model);
        subView = isClass(View) ? new View({
          model: model
        }) : View;
        options.viewList[model.cid] = subView;
        options.addHandler.call(view, holder, subView);
      }
      function eachRemoveListener(model){
        var subView, ref$, key$, ref1$;
        subView = (ref1$ = (ref$ = options.viewList)[key$ = model.cid], delete ref$[key$], ref1$);
        options.delHandler.call(view, holder, subView);
      }
    }
    eachHelper.addHandlers = {
      append: function(ul, view){
        ul.append(view.$el);
      },
      prepend: function(ul, view){
        ul.prepend(view.$el);
      },
      fadeIn: function(ul, view){
        view.$el.hide().appendTo(ul).fadeIn();
      },
      slideIn: function(ul, view){
        view.$el.hide().appendTo(ul).slideIn();
      }
    };
    eachHelper.delHandlers = {
      remove: function(ul, view){
        view.$el.remove();
      },
      fadeOut: function(ul, view){
        view.$el.fadeOut(function(){
          return view.$el.remove();
        });
      },
      slideOut: function(ul, view){
        view.$el.slideOut(function(){
          return view.$el.remove();
        });
      }
    };
    function isClass(func){
      return func.hasOwnProperty('__super__');
    }
    return DOMView;
  });
}).call(this);
